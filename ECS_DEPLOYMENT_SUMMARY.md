# ğŸ‰ AWSomeShop ECS éƒ¨ç½²æ–¹æ¡ˆ - å®Œæˆæ€»ç»“

## âœ… å·²åˆ›å»ºçš„éƒ¨ç½²èµ„æº

æˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†ä¸€å¥—å®Œæ•´çš„ AWS ECS éƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

### ğŸ“¦ Docker é…ç½®ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
```
AWSomeShopEmployeeRewardsSite/
â”œâ”€â”€ Dockerfile          # å¤šé˜¶æ®µæ„å»ºï¼Œä¼˜åŒ–é•œåƒå¤§å°
â”œâ”€â”€ .dockerignore       # æ„å»ºä¼˜åŒ–é…ç½®
â””â”€â”€ nginx.conf          # ç”Ÿäº§ç¯å¢ƒ Web æœåŠ¡å™¨é…ç½®
```

### â˜ï¸ AWS åŸºç¡€è®¾æ–½ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
```
pre-infra/
â””â”€â”€ ecs-deployment.yaml # CloudFormation æ¨¡æ¿ï¼ˆå®Œæ•´çš„ AWS èµ„æºå®šä¹‰ï¼‰
```

### ğŸš€ è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
```
pre-infra/
â”œâ”€â”€ deploy.sh           # å®Œæ•´éƒ¨ç½²è„šæœ¬ï¼ˆä¸»è¦ï¼‰
â”œâ”€â”€ quick-deploy.sh     # ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰
â””â”€â”€ local-test.sh       # æœ¬åœ°æµ‹è¯•è„šæœ¬
```

### ğŸ“š æ–‡æ¡£ï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰
```
pre-infra/
â”œâ”€â”€ README.md                    # è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ QUICK_REFERENCE.md           # å¿«é€Ÿå‚è€ƒå¡ç‰‡
â”œâ”€â”€ DEPLOYMENT_CHECKLIST.md      # éƒ¨ç½²æ£€æŸ¥æ¸…å•
â””â”€â”€ FILES_OVERVIEW.md            # æ–‡ä»¶æ€»è§ˆ

æ ¹ç›®å½•/
â”œâ”€â”€ DEPLOYMENT_INSTRUCTIONS.md   # å®Œæ•´éƒ¨ç½²æŒ‡å—
â””â”€â”€ ECS_DEPLOYMENT_SUMMARY.md    # æœ¬æ–‡ä»¶
```

**æ€»è®¡**: 12ä¸ªæ–‡ä»¶ï¼Œæ¶µç›–éƒ¨ç½²çš„æ‰€æœ‰æ–¹é¢

---

## ğŸ—ï¸ éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Internet                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Load Balancer (ALB)                 â”‚
â”‚  - å¥åº·æ£€æŸ¥                                               â”‚
â”‚  - è´Ÿè½½å‡è¡¡                                               â”‚
â”‚  - è‡ªåŠ¨æ•…éšœè½¬ç§»                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ECS Task 1      â”‚           â”‚  ECS Task 2      â”‚
â”‚  (Fargate)       â”‚           â”‚  (Fargate)       â”‚
â”‚                  â”‚           â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Nginx     â”‚  â”‚           â”‚  â”‚  Nginx     â”‚  â”‚
â”‚  â”‚  +         â”‚  â”‚           â”‚  â”‚  +         â”‚  â”‚
â”‚  â”‚  React App â”‚  â”‚           â”‚  â”‚  React App â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CloudWatch Logs & Monitoring                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„ç‰¹ç‚¹

âœ… **é«˜å¯ç”¨æ€§**: å¤šå¯ç”¨åŒºéƒ¨ç½²ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»  
âœ… **è‡ªåŠ¨æ‰©å±•**: æ”¯æŒæ ¹æ®è´Ÿè½½è‡ªåŠ¨æ‰©å±•  
âœ… **é›¶åœæœºæ›´æ–°**: æ»šåŠ¨æ›´æ–°ç­–ç•¥  
âœ… **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹å’Œæ›¿æ¢ä¸å¥åº·çš„å®¹å™¨  
âœ… **è´Ÿè½½å‡è¡¡**: ALB è‡ªåŠ¨åˆ†é…æµé‡  
âœ… **æ—¥å¿—ç›‘æ§**: CloudWatch é›†ä¸­æ—¥å¿—ç®¡ç†  

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3æ­¥éƒ¨ç½²ï¼‰

### æ­¥éª¤1: å‡†å¤‡ç¯å¢ƒ

```bash
# ç¡®è®¤ AWS CLI å·²é…ç½®
aws sts get-caller-identity

# ç¡®è®¤ Docker å·²å®‰è£…
docker --version
```

### æ­¥éª¤2: ä¸€é”®éƒ¨ç½²

```bash
cd pre-infra
chmod +x quick-deploy.sh
./quick-deploy.sh
```

### æ­¥éª¤3: è®¿é—®åº”ç”¨

éƒ¨ç½²å®Œæˆåï¼Œè„šæœ¬ä¼šè¾“å‡ºåº”ç”¨ URLï¼Œä¾‹å¦‚ï¼š
```
http://dev-awsomeshop-alb-1234567890.us-east-1.elb.amazonaws.com
```

**å°±è¿™ä¹ˆç®€å•ï¼** ğŸ‰

---

## ğŸ“Š éƒ¨ç½²ä¿¡æ¯

### é»˜è®¤é…ç½®

| é¡¹ç›® | é…ç½® |
|------|------|
| **ç¯å¢ƒ** | dev (å¼€å‘ç¯å¢ƒ) |
| **åŒºåŸŸ** | us-east-1 |
| **å®¹å™¨æ•°é‡** | 2 ä¸ª |
| **CPU** | 0.25 vCPU per task |
| **å†…å­˜** | 512 MB per task |
| **ç«¯å£** | 80 (HTTP) |
| **å¥åº·æ£€æŸ¥** | /health |

### éƒ¨ç½²æ—¶é—´

- **é¦–æ¬¡éƒ¨ç½²**: çº¦ 10-15 åˆ†é’Ÿ
- **æ›´æ–°éƒ¨ç½²**: çº¦ 5-8 åˆ†é’Ÿ
- **æœ¬åœ°æµ‹è¯•**: çº¦ 2-3 åˆ†é’Ÿ

### é¢„è®¡æˆæœ¬

**å¼€å‘ç¯å¢ƒ**: ~$35/æœˆ

åŒ…å«ï¼š
- ECS Fargate: ~$15
- Application Load Balancer: ~$16
- Data Transfer: ~$1
- CloudWatch Logs: ~$3

> ğŸ’¡ æµ‹è¯•å®Œæˆåè®°å¾—åˆ é™¤èµ„æºä»¥é¿å…æŒç»­è´¹ç”¨

---

## ğŸ§ª æµ‹è¯•è´¦å·

éƒ¨ç½²å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹è´¦å·æµ‹è¯•ï¼š

| è§’è‰² | ç”¨æˆ·å | å¯†ç  | åŠŸèƒ½ |
|------|--------|------|------|
| ç®¡ç†å‘˜ | admin | password123 | å®Œæ•´ç®¡ç†åŠŸèƒ½ |
| å‘˜å·¥ | zhangsan | password123 | å‘˜å·¥åŠŸèƒ½ |
| å‘˜å·¥ | lisi | password123 | å‘˜å·¥åŠŸèƒ½ |

---

## ğŸ“– æ–‡æ¡£å¯¼èˆª

### æ–°æ‰‹å…¥é—¨
1. ğŸ“˜ **å…ˆè¯»**: `DEPLOYMENT_INSTRUCTIONS.md` - å®Œæ•´çš„éƒ¨ç½²æŒ‡å—
2. âœ… **æ£€æŸ¥**: `pre-infra/DEPLOYMENT_CHECKLIST.md` - ç¡®ä¿ä¸é—æ¼ä»»ä½•æ­¥éª¤

### å¿«é€Ÿå‚è€ƒ
- ğŸ” **å¸¸ç”¨å‘½ä»¤**: `pre-infra/QUICK_REFERENCE.md`
- ğŸ“ **æ–‡ä»¶è¯´æ˜**: `pre-infra/FILES_OVERVIEW.md`

### è¯¦ç»†æ–‡æ¡£
- ğŸ“š **å®Œæ•´æ–‡æ¡£**: `pre-infra/README.md`

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯åš

1. âœ… **æœ¬åœ°æµ‹è¯•**ï¼ˆæ¨èï¼‰
   ```bash
   cd pre-infra
   ./local-test.sh
   # è®¿é—® http://localhost:8080
   ```

2. âœ… **éƒ¨ç½²åˆ° AWS**
   ```bash
   cd pre-infra
   ./quick-deploy.sh
   ```

3. âœ… **éªŒè¯éƒ¨ç½²**
   - è®¿é—® ALB URL
   - æµ‹è¯•ç™»å½•åŠŸèƒ½
   - æ£€æŸ¥æ—¥å¿—è¾“å‡º

### åç»­ä¼˜åŒ–

1. ğŸ” **é…ç½® HTTPS**
   - ç”³è¯· ACM è¯ä¹¦
   - é…ç½® ALB HTTPS ç›‘å¬å™¨
   - å¼ºåˆ¶ HTTPS é‡å®šå‘

2. ğŸŒ **é…ç½®è‡ªå®šä¹‰åŸŸå**
   - åœ¨ Route 53 åˆ›å»ºåŸŸå
   - é…ç½® DNS è®°å½•æŒ‡å‘ ALB
   - æ›´æ–° ACM è¯ä¹¦

3. ğŸ“ˆ **é…ç½® Auto Scaling**
   - åŸºäº CPU ä½¿ç”¨ç‡
   - åŸºäºå†…å­˜ä½¿ç”¨ç‡
   - åŸºäºè¯·æ±‚æ•°é‡

4. ğŸ”„ **é›†æˆ CI/CD**
   - GitHub Actions
   - AWS CodePipeline
   - è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²

5. ğŸ›¡ï¸ **å¢å¼ºå®‰å…¨æ€§**
   - é…ç½® WAF
   - å¯ç”¨ Shield
   - é…ç½® Security Hub

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### éƒ¨ç½²ç›¸å…³
```bash
# éƒ¨ç½²
./quick-deploy.sh

# æ›´æ–°
./deploy.sh dev

# æœ¬åœ°æµ‹è¯•
./local-test.sh
```

### æŸ¥çœ‹çŠ¶æ€
```bash
# è·å– URL
aws cloudformation describe-stacks \
    --stack-name dev-awsomeshop-frontend \
    --query 'Stacks[0].Outputs[?OutputKey==`LoadBalancerURL`].OutputValue' \
    --output text

# æŸ¥çœ‹æœåŠ¡
aws ecs describe-services \
    --cluster dev-awsomeshop-cluster \
    --services dev-awsomeshop-frontend-service

# æŸ¥çœ‹æ—¥å¿—
aws logs tail /ecs/dev-awsomeshop-frontend --follow
```

### æ¸…ç†èµ„æº
```bash
# åˆ é™¤å †æ ˆ
aws cloudformation delete-stack --stack-name dev-awsomeshop-frontend

# åˆ é™¤ ECR
aws ecr delete-repository --repository-name awsomeshop-frontend --force
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: éƒ¨ç½²å¤±è´¥

**æ£€æŸ¥**:
```bash
aws cloudformation describe-stack-events \
    --stack-name dev-awsomeshop-frontend \
    --max-items 20
```

### é—®é¢˜2: æ— æ³•è®¿é—®åº”ç”¨

**è§£å†³æ­¥éª¤**:
1. ç­‰å¾… 2-3 åˆ†é’Ÿè®©æœåŠ¡å®Œå…¨å¯åŠ¨
2. æ£€æŸ¥ ECS æœåŠ¡çŠ¶æ€
3. æ£€æŸ¥ç›®æ ‡ç»„å¥åº·çŠ¶æ€
4. æŸ¥çœ‹å®¹å™¨æ—¥å¿—

### é—®é¢˜3: å¥åº·æ£€æŸ¥å¤±è´¥

**æ£€æŸ¥æ—¥å¿—**:
```bash
aws logs tail /ecs/dev-awsomeshop-frontend --follow
```

---

## ğŸ“ è·å–å¸®åŠ©

### æŸ¥çœ‹æ–‡æ¡£
```bash
# è¯¦ç»†æ–‡æ¡£
cat pre-infra/README.md

# å¿«é€Ÿå‚è€ƒ
cat pre-infra/QUICK_REFERENCE.md

# éƒ¨ç½²æŒ‡å—
cat DEPLOYMENT_INSTRUCTIONS.md
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æ—¥å¿—
aws logs tail /ecs/dev-awsomeshop-frontend --follow

# CloudFormation äº‹ä»¶
aws cloudformation describe-stack-events \
    --stack-name dev-awsomeshop-frontend

# ECS æœåŠ¡äº‹ä»¶
aws ecs describe-services \
    --cluster dev-awsomeshop-cluster \
    --services dev-awsomeshop-frontend-service \
    --query 'services[0].events[0:10]'
```

---

## âœ¨ æ€»ç»“

ä½ ç°åœ¨æ‹¥æœ‰ï¼š

âœ… **å®Œæ•´çš„ Docker é…ç½®** - ä¼˜åŒ–çš„ç”Ÿäº§ç¯å¢ƒé•œåƒ  
âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬** - ä¸€é”®éƒ¨ç½²åˆ° AWS  
âœ… **CloudFormation æ¨¡æ¿** - å®Œæ•´çš„åŸºç¡€è®¾æ–½å³ä»£ç   
âœ… **è¯¦ç»†çš„æ–‡æ¡£** - ä»å…¥é—¨åˆ°ç²¾é€š  
âœ… **æµ‹è¯•å·¥å…·** - æœ¬åœ°éªŒè¯å’Œæ•…éšœæ’æŸ¥  

**ç°åœ¨å°±å¼€å§‹éƒ¨ç½²å§ï¼** ğŸš€

```bash
cd pre-infra
./quick-deploy.sh
```

---

**éƒ¨ç½²æ„‰å¿«ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–æŸ¥çœ‹æ—¥å¿—ã€‚** ğŸ˜Š
